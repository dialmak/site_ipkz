---
title: Віддалене керування
icon: material/remote-desktop
---

# Віддалене керування по протоколу Modbus.

Для взаємодії перетворювача із системами верхнього рівня передбачається передавання інформації по витій парі RS-485 або мережі стільникового зв'язку GSM. На програмному рівні замовник може використовувати Modbus RTU або Modbus TCP/IP протоколи.

При побудові мережі використовується принцип організації ведучий-ведений (master-slave). 
В мережі повинен бути тільки один ведучий і може бути до 247 ведених. Як ведучий використовується ПК або ПЛК, а як ведені – перетворювачі ІПКЗ. 
Ініціатором циклів обміну повинен виступати тільки ведучий. Запити ведучого індивідуальні, які адресуються конкретному перетворювачу. Ведені здійснюють передачу даних, відповідаючи на індивідуальні запити ведучого. 
При виявленні помилок при отриманні запитів або неможливості виконання отриманої команди, ведений генерує повідомлення про помилку або не відповідає.
 
## Мережа RS-485 та Modbus RTU протокол.

Для з’єднання на фізичному рівні використовуються мережа RS-485.

- Для стабільності і безпеки зв'язку використовується ізольований прийомопередавач сигналів з ізольованим джерелом живлення.
-	Рівні сигналів відповідають стандарту EIA/TIA RS-485, навантаження прийомопередавача 1/8 UL.
- Для узгодження та захисного зміщення сигналів RS-485 передбачені один термінальний та два підтягуючі резистори. Їх можна підключити або відключити через DIP перемикачі. Заводське положення термінального та підтягуючих резисторів - відключені.
- Використовується напівдуплексний режим.
-	Формат кадру обміну даними: 8N1, 1 старт-біт, 8 біт інформації, 1 стоп-біт, без контролю чіткості.
-	Бітрейт в мережі RS-485 може бути встановлений 4800, 9600, 19200, 38400, 57600 або 115200 baud. Заводське значення 9600 baud.
- ModBus ID адреса сервера кожного перетворювача в одній мережі RS-485 має бути унікальна й встановлена індивідуально в діапазоні від 1 до 247. Заводське значення 1.
- Програмний рівень передачі пакетів даних відповідає протоколу Modbus RTU.

!!! info "Варіанти налаштування бітрейта та Modbus ID адреси для мережі RS-485"

    - Вручну використовуючи ручку енкодера та дисплей.
    - За домогогою WEB інтерфейсу.
    - Записом в відповідні регістри Modbus через мережу GSM.

## Мережа GSM та Modbus TCP/IP протокол.

Для з’єднання на фізичному рівні використовуються мережа GSM.

- Налаштування GSM модему та Modbus TCP/IP сервера проводиться відповідно до Додатка 2.
- На відміну від мережі RS-485 ModBus ID адреса сервера перетворювача в мережі GSM непотрібна унікальна та може бути довільною від 1 до 247. Але налаштування можливе. Заводське значення 1.
- Програмний рівень передачі пакетів даних відповідає протоколу Modbus TCP/IP.

!!! info "Варіанти налаштування Modbus ID адреси для мережі GSM"

    - Вручну використовуючи ручку енкодера та дисплей.
    - За домогогою WEB інтерфейсу.
    - Записом в відповідні регістри Modbus через мережу RS-485.

## Загальний опис регістрів та даних ModBus RTU/TCP.

Для читання даних та керування ІПКЗ використовується набір регістрів і функції читання регістрів 3 (0x03) та 4 (0x04), запису в один регістр 6 (0x06), запис в декілька регістрів 16 (0x10). Інші функції ігноруються.

- Для читання значень з одного або/та декількох регістрів потрібно використовувати функцію 0x03 (Read Holding Registers) або/та 0x04 (Read Input Registers).
- Для запису в один регістр потрібно використовувати функцію 0x06 (Write Single Register).
- Для запису в один або декілька регістрів потрібно використовувати функцію 0x10 (Write Multiple regiters).

Перетворювачі передають числа `int16_t`, `int32_t`, `uint32_t` та рядки `string`. Протокол обміну ModBus RTU/TCP не має засобів позначення типу переданих даних. Відповідальність по визначенню типу лягає на програмне забезпечення верхнього рівня. ModBus RTU/TCP використовує big-endian представлення для адреси та даних. Це означає, що коли передається числова величина, більша за один байт, першим надсилається старший байт. Нижче представлено приклади передачі , числа в прикладах у шістнадцятковому форматі.

-	При передачі `int16_t` числа `0x0102` першим байтом буде надіслано `0x01`, другим `0х02`. 
-	При передачі `int32_t` числа `0x01020304` першим байтом буде надіслано `0x01`, другим `0х02`, третім `0х03`, четвертим `0х04`.

Детальний опис регістрів ModBus RTU/TCP викладено в [Додатку 3.](./modbus-registers.md)

